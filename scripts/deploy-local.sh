#!/bin/bash

# Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ´Ğ»Ñ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ Ñ Docker Compose

set -e

echo "ğŸš€ Starting local deployment..."

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ .env Ñ„Ğ°Ğ¹Ğ»Ğ°
if [ ! -f .env ]; then
    echo "âš ï¸  .env file not found. Creating from .env.example..."
    cp .env.example .env
    echo "ğŸ“ Please edit .env file with your credentials"
    exit 1
fi

# ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
echo "ğŸ›‘ Stopping existing containers..."
docker-compose down

# Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ°
echo "ğŸ”¨ Building Docker image..."
docker-compose build

# Ğ—Ğ°Ğ¿ÑƒÑĞº ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€Ğ¾Ğ²
echo "â–¶ï¸  Starting containers..."
docker-compose up -d

# ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ° PostgreSQL
echo "â³ Waiting for PostgreSQL to be ready..."
sleep 10

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
echo "âœ… Checking container status..."
docker-compose ps

# Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ»Ğ¾Ğ³Ğ¾Ğ²
echo "ğŸ“‹ Application logs:"
docker-compose logs webapp

echo ""
echo "âœ¨ Deployment completed!"
echo "ğŸŒ Application is running at: http://localhost:8080"
echo "ğŸ—„ï¸  PostgreSQL is running at: localhost:5432"
echo ""
echo "ğŸ“Š To view logs: docker-compose logs -f webapp"
echo "ğŸ›‘ To stop: docker-compose down"
