# üåê –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Yandex Cloud

## –û–±–∑–æ—Ä

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **3 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–∞** Yandex Cloud:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ           –í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ                       ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ  ‚îÇ  ASP.NET     ‚îÇ  ‚îÇ  Entity      ‚îÇ            ‚îÇ
‚îÇ  ‚îÇ  Core App    ‚îÇ  ‚îÇ  Framework   ‚îÇ            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
‚îÇ         ‚îÇ                  ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ                  ‚îÇ
          ‚îÇ                  ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Yandex   ‚îÇ      ‚îÇ   Yandex    ‚îÇ
    ‚îÇ  Object   ‚îÇ      ‚îÇ  Managed    ‚îÇ
    ‚îÇ  Storage  ‚îÇ      ‚îÇ  PostgreSQL ‚îÇ
    ‚îÇ   (S3)    ‚îÇ      ‚îÇ             ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ
          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ    Yandex      ‚îÇ
    ‚îÇ   Managed      ‚îÇ
    ‚îÇ  Kubernetes    ‚îÇ
    ‚îÇ     (MSK)      ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 1. üì¶ Yandex Object Storage (S3)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –æ–±–ª–∞—á–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### –ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**YandexStorageService.cs:**
```csharp
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç AWS SDK –¥–ª—è .NET (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API)
using Amazon.S3;
using Amazon.S3.Model;

public class YandexStorageService : IStorageService
{
    private readonly IAmazonS3 _s3Client;
    private readonly string _bucketName;

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
    public async Task<string> UploadFileAsync(Stream fileStream, string fileName, string contentType)
    {
        var request = new PutObjectRequest
        {
            BucketName = _bucketName,           // –ò–º—è –±–∞–∫–µ—Ç–∞
            Key = fileName,                      // –ò–º—è —Ñ–∞–π–ª–∞
            InputStream = fileStream,            // –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
            ContentType = contentType,           // MIME —Ç–∏–ø
            CannedACL = S3CannedACL.PublicRead  // –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø
        };

        await _s3Client.PutObjectAsync(request);
        return GetFileUrl(fileName);
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ URL
    public string GetFileUrl(string fileName)
    {
        return $"https://storage.yandexcloud.net/{_bucketName}/{fileName}";
    }
}
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Program.cs

```csharp
// –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
var accessKey = builder.Configuration["YandexStorage:AccessKey"];
var secretKey = builder.Configuration["YandexStorage:SecretKey"];
var serviceUrl = "https://storage.yandexcloud.net";

// –°–æ–∑–¥–∞–Ω–∏–µ S3 –∫–ª–∏–µ–Ω—Ç–∞
var credentials = new BasicAWSCredentials(accessKey, secretKey);
var config = new AmazonS3Config
{
    ServiceURL = serviceUrl,
    ForcePathStyle = true  // –í–∞–∂–Ω–æ –¥–ª—è Yandex!
};

builder.Services.AddSingleton<IAmazonS3>(new AmazonS3Client(credentials, config));
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**appsettings.json:**
```json
{
  "YandexStorage": {
    "AccessKey": "",        // –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞
    "SecretKey": "",        // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
    "BucketName": "",       // –ò–º—è –±–∞–∫–µ—Ç–∞
    "ServiceUrl": "https://storage.yandexcloud.net"
  }
}
```

**Kubernetes Secret:**
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: imagegallery-secrets
stringData:
  yandex-access-key: "YCAJExxxxxxxxx"
  yandex-secret-key: "YCMxxxxxxxxxxxxxx"
  yandex-bucket-name: "imagegallery-bucket"
```

### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∫–µ—Ç–∞

```bash
# –ß–µ—Ä–µ–∑ yc CLI
yc storage bucket create \
  --name imagegallery-bucket \
  --default-storage-class standard \
  --public-read

# –ò–ª–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å:
# https://console.cloud.yandex.ru/folders/<folder-id>/storage
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞

```bash
# –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
yc iam service-account create --name storage-sa

# –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å
yc resource-manager folder add-access-binding <folder-id> \
  --role storage.editor \
  --subject serviceAccount:<sa-id>

# –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞
yc iam access-key create --service-account-name storage-sa
```

–í—ã–≤–æ–¥:
```
access_key:
  id: aje...
  key_id: YCAJExxxxxxxxx          # –≠—Ç–æ AccessKey
secret: YCMxxxxxxxxxxxxxx         # –≠—Ç–æ SecretKey
```

---

## 2. üóÑÔ∏è Yandex Managed Service for PostgreSQL

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∏–º—è, —Ä–∞–∑–º–µ—Ä, –¥–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏, –æ–ø–∏—Å–∞–Ω–∏–µ).

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### –ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**ApplicationDbContext.cs:**
```csharp
using Microsoft.EntityFrameworkCore;

public class ApplicationDbContext : DbContext
{
    public DbSet<ImageMetadata> Images { get; set; }

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        modelBuilder.Entity<ImageMetadata>(entity =>
        {
            entity.HasKey(e => e.Id);
            entity.Property(e => e.FileName).IsRequired();
            entity.Property(e => e.StorageUrl).IsRequired();
        });
    }
}
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Program.cs

```csharp
// –ß—Ç–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
var connectionString = builder.Configuration.GetConnectionString("DefaultConnection");

if (!string.IsNullOrEmpty(connectionString))
{
    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL
    builder.Services.AddDbContext<ApplicationDbContext>(options =>
        options.UseNpgsql(connectionString));
}
else
{
    // Fallback –Ω–∞ In-Memory –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    builder.Services.AddDbContext<ApplicationDbContext>(options =>
        options.UseInMemoryDatabase("ImageGalleryDb"));
}
```

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```
Host=<cluster-host>;Port=6432;Database=imagegallery;Username=dbuser;Password=<password>;SSL Mode=Require
```

**Kubernetes Secret:**
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: imagegallery-secrets
stringData:
  connection-string: "Host=c-xxx.rw.mdb.yandexcloud.net;Port=6432;Database=imagegallery;Username=dbuser;Password=SecurePass123!;SSL Mode=Require"
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ PostgreSQL

```bash
# –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
yc managed-postgresql cluster create \
  --name imagegallery-db \
  --environment production \
  --network-name default \
  --postgresql-version 16 \
  --resource-preset s2.micro \
  --disk-size 10 \
  --disk-type network-ssd \
  --user name=dbuser,password=SecurePass123! \
  --database name=imagegallery,owner=dbuser

# –ü–æ–ª—É—á–∏—Ç—å —Ö–æ—Å—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
yc managed-postgresql cluster list-hosts imagegallery-db
```

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
CREATE TABLE Images (
    Id SERIAL PRIMARY KEY,
    FileName VARCHAR(255) NOT NULL,
    OriginalFileName VARCHAR(255) NOT NULL,
    ContentType VARCHAR(100) NOT NULL,
    FileSize BIGINT NOT NULL,
    StorageUrl VARCHAR(500) NOT NULL,
    UploadedAt TIMESTAMP NOT NULL,
    Description VARCHAR(1000)
);
```

---

## 3. ‚ò∏Ô∏è Yandex Managed Service for Kubernetes (MSK)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### Deployment –º–∞–Ω–∏—Ñ–µ—Å—Ç

**k8s-deployment.yaml:**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: imagegallery-deployment
spec:
  replicas: 2
  template:
    spec:
      containers:
      - name: imagegallery
        image: cr.yandex/<registry-id>/imagegallery:latest
        ports:
        - containerPort: 8080
        env:
        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
        - name: ConnectionStrings__DefaultConnection
          valueFrom:
            secretKeyRef:
              name: imagegallery-secrets
              key: connection-string
        # Yandex Object Storage
        - name: YandexStorage__AccessKey
          valueFrom:
            secretKeyRef:
              name: imagegallery-secrets
              key: yandex-access-key
        - name: YandexStorage__SecretKey
          valueFrom:
            secretKeyRef:
              name: imagegallery-secrets
              key: yandex-secret-key
        - name: YandexStorage__BucketName
          valueFrom:
            secretKeyRef:
              name: imagegallery-secrets
              key: yandex-bucket-name
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes

```bash
# –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä
yc managed-kubernetes cluster create \
  --name imagegallery-k8s \
  --network-name default \
  --zone ru-central1-a \
  --public-ip \
  --release-channel stable \
  --version 1.28

# –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É —É–∑–ª–æ–≤
yc managed-kubernetes node-group create \
  --name imagegallery-nodes \
  --cluster-name imagegallery-k8s \
  --fixed-size 2 \
  --cores 2 \
  --memory 4

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å kubectl
yc managed-kubernetes cluster get-credentials imagegallery-k8s --external
```

---

## 4. üì¶ Yandex Container Registry

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–•—Ä–∞–Ω–µ–Ω–∏–µ Docker –æ–±—Ä–∞–∑–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

#### –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–µ—Å—Ç—Ä–∞

```bash
# –°–æ–∑–¥–∞—Ç—å —Ä–µ–µ—Å—Ç—Ä
yc container registry create --name imagegallery-registry

# –ü–æ–ª—É—á–∏—Ç—å ID —Ä–µ–µ—Å—Ç—Ä–∞
REGISTRY_ID=$(yc container registry get imagegallery-registry --format json | jq -r .id)

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Docker
yc container registry configure-docker
```

#### –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞

```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t cr.yandex/$REGISTRY_ID/imagegallery:latest .

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ —Ä–µ–µ—Å—Ç—Ä
docker push cr.yandex/$REGISTRY_ID/imagegallery:latest
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Kubernetes

```yaml
spec:
  containers:
  - name: imagegallery
    image: cr.yandex/<registry-id>/imagegallery:latest
    imagePullPolicy: Always
```

---

## üîÑ –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ë—Ä–∞—É–∑–µ—Ä
   POST /Images/Upload (multipart/form-data)
   
2. –ë—Ä–∞—É–∑–µ—Ä ‚Üí Kubernetes Load Balancer
   HTTP Request
   
3. Load Balancer ‚Üí Pod (ASP.NET Core)
   –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞
   
4. ImagesController.Upload()
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏
   
5. YandexStorageService.UploadFileAsync()
   - AWS SDK ‚Üí Yandex Object Storage
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –≤ –±–∞–∫–µ—Ç
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ URL
   
6. ApplicationDbContext.SaveChangesAsync()
   - Entity Framework ‚Üí PostgreSQL
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
   
7. Redirect ‚Üí /Images/Index
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–∞–ª–µ—Ä–µ–∏
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –≥–∞–ª–µ—Ä–µ–∏

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ë—Ä–∞—É–∑–µ—Ä
   GET /Images/Index
   
2. ImagesController.Index()
   - Query PostgreSQL –¥–ª—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
   
3. Render View
   - HTML —Å URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   
4. –ë—Ä–∞—É–∑–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –ü—Ä—è–º–æ –∏–∑ Object Storage
   - https://storage.yandexcloud.net/bucket/image.jpg
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

**–õ–æ–∫–∞–ª—å–Ω–æ (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞):**
```json
// appsettings.Development.json
{
  "YandexStorage": {
    "AccessKey": "local-dev-key",
    "SecretKey": "local-dev-secret"
  }
}
```

**Kubernetes (–ø—Ä–æ–¥–∞–∫—à–µ–Ω):**
```yaml
# Kubernetes Secret (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω)
apiVersion: v1
kind: Secret
metadata:
  name: imagegallery-secrets
type: Opaque
stringData:
  yandex-access-key: "YCAJExxxxxxxxx"
  yandex-secret-key: "YCMxxxxxxxxxxxxxx"
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# Kubernetes Pod –ø–æ–ª—É—á–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –∫–∞–∫ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
env:
- name: YandexStorage__AccessKey
  valueFrom:
    secretKeyRef:
      name: imagegallery-secrets
      key: yandex-access-key
```

### IAM —Ä–æ–ª–∏

```bash
# –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è Object Storage
yc iam service-account create --name storage-sa

# –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª–∏
yc resource-manager folder add-access-binding <folder-id> \
  --role storage.editor \
  --subject serviceAccount:<sa-id>

# –°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è Kubernetes
yc iam service-account create --name k8s-sa

# –ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª–∏
yc resource-manager folder add-access-binding <folder-id> \
  --role container-registry.images.puller \
  --subject serviceAccount:<sa-id>
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –õ–æ–≥–∏ –≤ Kubernetes
kubectl logs -f deployment/imagegallery-deployment

# –õ–æ–≥–∏ PostgreSQL
yc managed-postgresql cluster list-logs imagegallery-db

# –õ–æ–≥–∏ –≤ Yandex Cloud Logging (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
yc logging read --group-id=<log-group-id>
```

### –ú–µ—Ç—Ä–∏–∫–∏

```bash
# –ú–µ—Ç—Ä–∏–∫–∏ Kubernetes
kubectl top pods
kubectl top nodes

# –ú–µ—Ç—Ä–∏–∫–∏ PostgreSQL
yc managed-postgresql cluster list-operations imagegallery-db

# –ú–µ—Ç—Ä–∏–∫–∏ Object Storage
yc storage bucket stats imagegallery-bucket
```

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å

### –ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (–º–µ—Å—è—Ü)

| –°–µ—Ä–≤–∏—Å | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|--------------|-----------|
| Kubernetes | 2 —É–∑–ª–∞ (2 CPU, 4GB) | ~$50-80 |
| PostgreSQL | s2.micro, 10GB SSD | ~$20-30 |
| Object Storage | 10GB —Ö—Ä–∞–Ω–∏–ª–∏—â–µ | ~$0.50-2 |
| Container Registry | 5GB –æ–±—Ä–∞–∑–æ–≤ | ~$0.50-1 |
| Load Balancer | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π | ~$10-15 |
| **–ò—Ç–æ–≥–æ** | | **~$81-128/–º–µ—Å—è—Ü** |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞—Ç—Ä–∞—Ç

1. **Preemptible VM** –¥–ª—è dev –æ–∫—Ä—É–∂–µ–Ω–∏—è (-70%)
2. **–ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–ª–∞—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
3. **Lifecycle policies** –¥–ª—è Object Storage
4. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞** –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É

```bash
# Object Storage
yc storage bucket create --name imagegallery-bucket --public-read

# PostgreSQL
yc managed-postgresql cluster create \
  --name imagegallery-db \
  --postgresql-version 16 \
  --user name=dbuser,password=SecurePass123! \
  --database name=imagegallery,owner=dbuser

# Kubernetes
yc managed-kubernetes cluster create --name imagegallery-k8s

# Container Registry
yc container registry create --name imagegallery-registry
```

### 2. –ü–æ–ª—É—á–∏—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

```bash
# Access Key –¥–ª—è Object Storage
yc iam access-key create --service-account-name storage-sa

# –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è PostgreSQL
yc managed-postgresql cluster list-hosts imagegallery-db

# ID —Ä–µ–µ—Å—Ç—Ä–∞
yc container registry get imagegallery-registry --format json | jq -r .id
```

### 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã

```bash
kubectl create secret generic imagegallery-secrets \
  --from-literal=connection-string="Host=<host>;Port=6432;Database=imagegallery;Username=dbuser;Password=SecurePass123!;SSL Mode=Require" \
  --from-literal=yandex-access-key="YCAJExxxxxxxxx" \
  --from-literal=yandex-secret-key="YCMxxxxxxxxxxxxxx" \
  --from-literal=yandex-bucket-name="imagegallery-bucket"
```

### 4. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑
docker build -t cr.yandex/$REGISTRY_ID/imagegallery:latest .
docker push cr.yandex/$REGISTRY_ID/imagegallery:latest

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
kubectl apply -f k8s-configmap.yaml
kubectl apply -f k8s-deployment.yaml
kubectl apply -f k8s-service.yaml

# –ü–æ–ª—É—á–∏—Ç—å –≤–Ω–µ—à–Ω–∏–π IP
kubectl get service imagegallery-service
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **[DEPLOYMENT.md](DEPLOYMENT.md)** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- **[QUICKSTART.md](QUICKSTART.md)** - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
- **[ARCHITECTURE.md](ARCHITECTURE.md)** - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. ‚úÖ **Object Storage** - S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API —á–µ—Ä–µ–∑ AWS SDK
2. ‚úÖ **PostgreSQL** - –ß–µ—Ä–µ–∑ Entity Framework Core –∏ Npgsql
3. ‚úÖ **Kubernetes** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏
4. ‚úÖ **Container Registry** - Docker push/pull
5. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** - CI/CD —á–µ—Ä–µ–∑ GitHub Actions

–í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ **–≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** - –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –≤ Yandex Cloud –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ! üöÄ
